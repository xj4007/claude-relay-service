# å°å·¾å†’åŠ©æ‰‹ - æ¶æ„åˆ†æä¸è®¾è®¡å†³ç­–

## ç”¨æˆ·çš„å››ä¸ªæ ¸å¿ƒç–‘é—®åˆ†æ

### 1. âœ… ä¸éœ€è¦å¯¼å‡ºåŠŸèƒ½

**ç»“è®ºï¼šåˆç†**

**ç†ç”±ï¼š**
- ğŸ¯ **å°ç¨‹åºç‰¹æ€§é™åˆ¶**ï¼šå°ç¨‹åºæœ¬èº«å¯¹å¤§æ–‡ä»¶ä¸‹è½½å’Œå¯¼å‡ºçš„æ”¯æŒæœ‰é™
- ğŸ“± **ç”¨æˆ·åœºæ™¯ä¸åŒ¹é…**ï¼šå°ç¨‹åºç”¨æˆ·é€šå¸¸æ˜¯ç§»åŠ¨ç«¯æŸ¥è¯¢ï¼Œä¸éœ€è¦å¯¼å‡ºæŠ¥è¡¨
- ğŸ’¡ **å·®å¼‚åŒ–è®¾è®¡**ï¼šå¯¼å‡ºåŠŸèƒ½åœ¨ PC ç®¡ç†åå°ï¼ˆadmin-spaï¼‰å·²æœ‰ï¼Œæ— éœ€é‡å¤
- ğŸ”„ **ç”¨æˆ·æµç¨‹**ï¼šç”¨æˆ·éœ€è¦å®Œæ•´æŠ¥è¡¨ â†’ è½¬åˆ° PC åå° â†’ ä½¿ç”¨å¯¼å‡ºåŠŸèƒ½

**ä¿®æ”¹å»ºè®®ï¼š**
- ç§»é™¤ä¹å®«æ ¼ä¸­çš„"ğŸ“¤ å¯¼å‡º"èœå•
- æ”¹ä¸º"ğŸ“‹ æ›´å¤š"æˆ–é¢„ç•™ä½ç½®
- å¦‚æœéœ€è¦åˆ†äº«æ•°æ®ï¼Œå¯æä¾›"åˆ†äº«ç»Ÿè®¡"åŠŸèƒ½ï¼ˆåˆ†äº«é“¾æ¥ï¼Œä»…å±•ç¤ºæ— ä¸‹è½½ï¼‰

**æ–°å¢çš„ä¹å®«æ ¼å¸ƒå±€ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“…   â”‚ ğŸ’°   â”‚ ğŸ“Š   â”‚
â”‚ ç­¾åˆ° â”‚ ä½™é¢ â”‚ æ—¥å¿— â”‚
â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜
â”‚ ğŸ’³   â”‚ ğŸ“‹   â”‚ âš™ï¸   â”‚
â”‚ å……å€¼ â”‚ æ›´å¤š â”‚ è®¾ç½® â”‚
â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜
â”‚ â“   â”‚ â„¹ï¸   â”‚      â”‚
â”‚ å¸®åŠ© â”‚ å…³äº â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. âœ… Key æŸ¥è¯¢æ”¯æŒåç§°å’Œå¯†é’¥æ ¼å¼

**ç»“è®ºï¼šéå¸¸åˆç†**

**ç†ç”±ï¼š**
- ğŸ‘¤ **ç”¨æˆ·ä½“éªŒ**ï¼šç”¨æˆ·å¯èƒ½ä¸è®°å¾—å®Œæ•´çš„ Key å¯†é’¥ï¼Œä½†è®°å¾— Key åç§°
- ğŸ” **å®‰å…¨è€ƒè™‘**ï¼šè¾“å…¥å®Œæ•´å¯†é’¥æ—¶ä»éœ€éªŒè¯ï¼Œè¾“å…¥åç§°æ—¶é€šè¿‡ç¼“å­˜åŒ¹é…
- ğŸ” **åŒé‡æŸ¥è¯¢æ–¹å¼**ï¼šæä¾›çµæ´»æ€§

**å®ç°æ–¹å¼ï¼š**

#### å‰ç«¯é€»è¾‘ï¼ˆkeyService.jsï¼‰

```javascript
class KeyService {
  // æ”¯æŒä¸¤ç§è¾“å…¥æ–¹å¼æŸ¥è¯¢ Key
  async queryKey(input) {
    let key = null

    // 1. å¦‚æœè¾“å…¥ä»¥ "cr_" å¼€å¤´ï¼Œåˆ™ä½œä¸ºå¯†é’¥æŸ¥è¯¢
    if (input.startsWith('cr_')) {
      key = await this.validateKeyBySecret(input)
    }
    // 2. å¦åˆ™ä½œä¸ºåç§°æŸ¥è¯¢æœ¬åœ°ç¼“å­˜
    else {
      key = await this.searchKeyByName(input)
    }

    return key
  }

  // é€šè¿‡å¯†é’¥éªŒè¯ï¼ˆè°ƒç”¨åç«¯ï¼‰
  async validateKeyBySecret(apiKey) {
    const response = await apiService.post('/wechat/key/validate', {
      apiKey: apiKey
    })
    if (response.valid) {
      // ä¿å­˜åˆ°æœ¬åœ°ç¼“å­˜
      await this.saveKey(response.keyData)
      return response.keyData
    }
    return null
  }

  // é€šè¿‡åç§°åœ¨æœ¬åœ°ç¼“å­˜æŸ¥è¯¢
  async searchKeyByName(keyName) {
    const allKeys = await storageService.getKeys()
    return allKeys.find(k => k.name === keyName)
  }
}
```

#### åç«¯ API è°ƒæ•´

```
POST /wechat/key/validate
è¯·æ±‚å‚æ•°è¯´æ˜ï¼š
{
  apiKey: "cr_xxx..." æˆ– "MyApp"
}

è¿”å›ç¤ºä¾‹ï¼š
{
  valid: true,
  keyData: {
    keyId: "uuid",
    name: "MyApp",
    apiKey: "cr_xxx...",  // è¿”å›å®Œæ•´Keyä¾›æœ¬åœ°å­˜å‚¨
    permissions: "all",
    isActive: true,
    quotaInfo: {...}
  }
}
```

#### UI æ”¹è¿›

**Key è¾“å…¥ç»„ä»¶ï¼š**

```vue
<!-- KeyInput.vue -->
<template>
  <div class="key-input">
    <input
      v-model="keyInput"
      placeholder="è¾“å…¥ Key åç§°æˆ–å¯†é’¥ (cr_xxx)"
      @input="handleSearch"
    />

    <!-- æœ¬åœ°ç¼“å­˜çš„ Key å»ºè®®åˆ—è¡¨ -->
    <div v-if="suggestions.length" class="suggestions">
      <div
        v-for="key in suggestions"
        :key="key.keyId"
        @click="selectKey(key)"
      >
        <span class="name">{{ key.name }}</span>
        <span class="status">{{ key.isActive ? 'æ´»è·ƒ' : 'ç¦ç”¨' }}</span>
      </div>
    </div>

    <button @click="validateAndAdd">éªŒè¯å¹¶æ·»åŠ </button>
  </div>
</template>

<script>
export default {
  data() {
    return {
      keyInput: '',
      suggestions: []
    }
  },
  methods: {
    handleSearch() {
      // 1. å¦‚æœè¾“å…¥çš„æ˜¯åç§°ï¼Œæ˜¾ç¤ºæœ¬åœ°ç¼“å­˜å»ºè®®
      if (!this.keyInput.startsWith('cr_')) {
        this.suggestions = this.filterLocalKeys(this.keyInput)
      } else {
        this.suggestions = []
      }
    },
    filterLocalKeys(name) {
      // ä»æœ¬åœ°å­˜å‚¨çš„ Keys ä¸­æ¨¡ç³Šæœç´¢
      const allKeys = this.$store.state.keys
      return allKeys.filter(k =>
        k.name.toLowerCase().includes(name.toLowerCase())
      )
    },
    selectKey(key) {
      this.keyInput = key.name
      this.suggestions = []
    },
    async validateAndAdd() {
      const key = await keyService.queryKey(this.keyInput)
      if (key) {
        // éªŒè¯æˆåŠŸ
        await this.addKey(key)
      }
    }
  }
}
</script>
```

**ä¼˜ç‚¹æ€»ç»“ï¼š**
- âœ… ç”¨æˆ·å¯å¿«é€Ÿä»æœ¬åœ°ç¼“å­˜é€‰æ‹©
- âœ… ç”¨æˆ·ä¹Ÿå¯æ·»åŠ æ–°çš„ Keyï¼ˆè¾“å…¥å®Œæ•´å¯†é’¥ï¼‰
- âœ… åç«¯åªéœ€éªŒè¯ä¸€æ¬¡ï¼Œä¹‹åé€šè¿‡æœ¬åœ°ç¼“å­˜æŸ¥è¯¢

---

### 3. âœ… ç”¨æˆ·æ¸…ç©ºç¼“å­˜éœ€é‡æ–°æ·»åŠ  Keyï¼ˆæ— éœ€åç«¯ç”¨æˆ·ç»‘å®šï¼‰

**ç»“è®ºï¼šéå¸¸åˆç†ï¼Œè¿™æ˜¯æœ€ä¼˜æ–¹æ¡ˆ**

**ç†ç”±ï¼š**

#### A. æ¶æ„ç®€åŒ–

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|
| **æ–¹æ¡ˆAï¼šæœ¬åœ°ç¼“å­˜ç®¡ç†ï¼ˆæ¨èï¼‰** | æ— éœ€ç»´æŠ¤ç”¨æˆ·-Keyç»‘å®šå…³ç³»ï¼›æ— éœ€ç”¨æˆ·ç™»å½•è®¤è¯ï¼›åç«¯ç®€å•ï¼›éšç§å‹å¥½ | ç”¨æˆ·æ¸…ç©ºç¼“å­˜éœ€é‡æ–°æ·»åŠ  |
| æ–¹æ¡ˆBï¼šåç«¯ç”¨æˆ·ç³»ç»Ÿ | ç”¨æˆ·ä¿¡æ¯æ°¸ä¹…ä¿å­˜ | éœ€è¦ç”¨æˆ·è´¦æˆ·ç³»ç»Ÿï¼›æ•°æ®éšç§ï¼›ç»´æŠ¤å¤æ‚ |
| æ–¹æ¡ˆCï¼šå¾®ä¿¡OpenIDç»‘å®š | å¯è¯†åˆ«ç”¨æˆ· | ç”¨æˆ·éœ€æˆæƒï¼›éšç§è€ƒè™‘ï¼›ä»éœ€è´¦æˆ·ç³»ç»Ÿ |

#### B. ç”¨æˆ·å¿ƒç†å­¦

```
åœºæ™¯1ï¼šç”¨æˆ·Aæ·»åŠ äº†Key
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å°ç¨‹åºæœ¬åœ°ç¼“å­˜     â”‚
â”‚ â”œâ”€ MyApp (cr_xxx) â”‚
â”‚ â””â”€ TestKey        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
ç”¨æˆ·Aæ¸…ç©ºå°ç¨‹åºæ•°æ®
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å°ç¨‹åºæœ¬åœ°ç¼“å­˜     â”‚
â”‚ ï¼ˆå·²æ¸…ç©ºï¼‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
ç”¨æˆ·Aéœ€è¦é‡æ–°æ·»åŠ Key
        â†“
ç”¨æˆ·ä½“éªŒï¼šç”¨æˆ·ç†è§£"æ¸…ç©º=é‡æ¥"
```

**ç”¨æˆ·ä¼šä¸»åŠ¨æƒ³åˆ°ï¼š**
- "æˆ‘æ¸…ç©ºäº†å°ç¨‹åºæ•°æ®ï¼Œå½“ç„¶è¦é‡æ–°é…ç½®"
- å°±åƒæ¸…ç©ºæµè§ˆå™¨ç¼“å­˜åéœ€è¦é‡æ–°ç™»å½•ä¸€æ ·

#### C. åç«¯é›¶è´Ÿæ‹…

ä½ çš„åç«¯å®Œå…¨ä¸éœ€è¦ï¼š
- âŒ ç”¨æˆ·è´¦æˆ·ç³»ç»Ÿ
- âŒ ç”¨æˆ·-Key çš„ç»‘å®šå…³ç³»è¡¨
- âŒ ç™»å½•è®¤è¯æµç¨‹
- âŒ ç”¨æˆ·çŠ¶æ€ç®¡ç†

**åç«¯åªéœ€ï¼š**
- âœ… Key éªŒè¯æ¥å£ï¼ˆå·²æœ‰ `POST /wechat/key/validate`ï¼‰
- âœ… åŸºäº Key çš„ä¸šåŠ¡æ¥å£ï¼ˆç­¾åˆ°ã€ä½™é¢ã€æ—¥å¿—ã€å……å€¼ï¼‰
- âœ… å¾®ä¿¡æ”¯ä»˜å›è°ƒå¤„ç†

#### D. æ•°æ®éšç§ä¼˜åŠ¿

- ğŸ” ç”¨æˆ·æ•°æ®å®Œå…¨æœ¬åœ°å­˜å‚¨ï¼Œæ— åç«¯è®°å½•
- ğŸ” æ— æ³•è¿½è¸ªç”¨æˆ·è¡Œä¸º
- ğŸ” ç¬¦åˆéšç§ä¿æŠ¤è¦æ±‚

#### E. ç”¨æˆ·æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·é¦–æ¬¡æ‰“å¼€å°ç¨‹åº                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ æœ¬åœ°ç¼“å­˜ä¸ºç©º        â”‚
    â”‚ æ˜¾ç¤º"é…ç½®Key"æç¤º   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·è¾“å…¥ Keyï¼ˆåç§°æˆ–å¯†é’¥ï¼‰           â”‚
â”‚ åç«¯éªŒè¯ â†’ ä¿å­˜åˆ°æœ¬åœ°               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç°åœ¨å¯ä»¥ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½             â”‚
â”‚ â€¢ æŸ¥è¯¢ä¿¡æ¯ï¼šç›´æ¥ä»æœ¬åœ°ç¼“å­˜Keyè·å–   â”‚
â”‚ â€¢ å‘èµ·è¯·æ±‚ï¼šé€šè¿‡X-API-Keyå¤´ä¼ é€     â”‚
â”‚ â€¢ åç«¯ï¼šåªéœ€éªŒè¯Keyæœ‰æ•ˆæ€§            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ åœºæ™¯1              åœºæ™¯2    â”‚
    â†“                   â†“
ç”¨æˆ·å¸è½½åâ†’         ç”¨æˆ·æ¸…ç©ºç¼“å­˜â†’
é‡è£…å°ç¨‹åº           æ¸…ç©ºæ•°æ®
    â†“                   â†“
é‡æ–°æ·»åŠ Key         é‡æ–°æ·»åŠ Key

ä¸¤ç§åœºæ™¯éƒ½å›åˆ°åˆå§‹çŠ¶æ€ï¼Œç”¨æˆ·ä½“éªŒä¸€è‡´
```

**æ€»ç»“ï¼šè¿™æ˜¯æœ€ç¬¦åˆå°ç¨‹åº"è½»åº”ç”¨"ç‰¹æ€§çš„æ–¹æ¡ˆ**

---

### 4. âœ… é¡µé¢æ”¯æŒåˆ‡æ¢ Keyï¼Œå……å€¼ä¹Ÿåªèƒ½é€‰ä¸€ä¸ª

**ç»“è®ºï¼šå®Œå…¨åˆç†ä¸”å¿…é¡»æ”¯æŒ**

**ç†ç”±ï¼š**

#### A. å¤š Key ç”¨æˆ·åœºæ™¯

```
çœŸå®ç”¨æˆ·åœºæ™¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·Açš„ Keys                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. MyApp (cr_abc123)        â”‚
â”‚    - æƒé™: all              â”‚
â”‚    - æœˆé™é¢: Â¥10,000        â”‚
â”‚    - å‰©ä½™: Â¥2,345           â”‚
â”‚                             â”‚
â”‚ 2. TestKey (cr_xyz789)      â”‚
â”‚    - æƒé™: claude only      â”‚
â”‚    - æœˆé™é¢: Â¥5,000         â”‚
â”‚    - å‰©ä½™: Â¥123             â”‚
â”‚                             â”‚
â”‚ 3. BackupKey (cr_def456)    â”‚
â”‚    - æƒé™: all              â”‚
â”‚    - æœˆé™é¢: Â¥50,000        â”‚
â”‚    - å‰©ä½™: Â¥48,900          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·éœ€è¦ï¼š
âœ… æŸ¥çœ‹æ¯ä¸ª Key çš„ä½™é¢
âœ… æ ¹æ®éœ€è¦é€‰æ‹©ä¸åŒ Key å……å€¼
âœ… æŸ¥çœ‹æ¯ä¸ª Key çš„æ¶ˆè´¹æ—¥å¿—
âœ… åˆ†åˆ«ç­¾åˆ°å¤šä¸ª Keyï¼ˆè·å¾—å¤šä»½å¥–åŠ±ï¼‰
```

#### B. UI å®ç°æ–¹æ¡ˆ

**æ”¹è¿›åçš„é¦–é¡µè®¾è®¡ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å°å·¾å†’åŠ©æ‰‹ - é¦–é¡µ                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å½“å‰ Key: â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚           â”‚ MyApp         â–¼     â”‚  â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚
â”‚  Key å¿«é€Ÿåˆ‡æ¢æ ï¼š                   â”‚
â”‚  [MyApp] [TestKey] [BackupKey]  â”‚
â”‚           â†‘ å½“å‰é€‰ä¸­              â”‚
â”‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å½“å‰ä½™é¢: Â¥ 2,345.00             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ ğŸ“…   â”‚ ğŸ’°   â”‚ ğŸ“Š   â”‚           â”‚
â”‚  â”‚ ç­¾åˆ° â”‚ ä½™é¢ â”‚ æ—¥å¿— â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚  â”‚ ğŸ’³   â”‚ ğŸ“‹   â”‚ âš™ï¸   â”‚           â”‚
â”‚  â”‚ å……å€¼ â”‚ æ›´å¤š â”‚ è®¾ç½® â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚  â”‚ â“   â”‚ â„¹ï¸   â”‚      â”‚           â”‚
â”‚  â”‚ å¸®åŠ© â”‚ å…³äº â”‚      â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                    â”‚
â”‚  æœ€è¿‘ Key æ“ä½œï¼š                    â”‚
â”‚  â”œâ”€ MyApp: ä½™é¢ Â¥2,345            â”‚
â”‚  â”œâ”€ TestKey: å·²ç­¾åˆ°               â”‚
â”‚  â””â”€ BackupKey: å¾…ç­¾åˆ°             â”‚
â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### C. å„åŠŸèƒ½é¡µé¢çš„ Key åˆ‡æ¢

**ä½™é¢æŸ¥è¯¢é¡µé¢ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ä½™é¢æŸ¥è¯¢                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å½“å‰ Key: [MyApp      â–¼]        â”‚
â”‚  *æ”¯æŒå¿«é€Ÿåˆ‡æ¢å…¶ä»–Keyâ†’ â€»       â”‚
â”‚                                 â”‚
â”‚  å½“å‰ä½™é¢: Â¥ 2,345.00           â”‚
â”‚  æœˆé™é¢: Â¥ 10,000.00            â”‚
â”‚  å·²ä½¿ç”¨: Â¥ 7,655.00             â”‚
â”‚                                 â”‚
â”‚  æƒé™: all                       â”‚
â”‚  çŠ¶æ€: æ´»è·ƒ âœ“                   â”‚
â”‚                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ [åˆ‡æ¢Key] [å……å€¼] [è¯¦æƒ…]    â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å……å€¼é¡µé¢ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å……å€¼                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é€‰æ‹© Key: [MyApp      â–¼]        â”‚
â”‚ (âš ï¸ å……å€¼ä»…é’ˆå¯¹é€‰ä¸­Key)         â”‚
â”‚                                 â”‚
â”‚ å½“å‰ä½™é¢: Â¥ 2,345.00           â”‚
â”‚                                 â”‚
â”‚ å……å€¼é‡‘é¢:                        â”‚
â”‚ [Â¥10][Â¥50][Â¥100][Â¥500]          â”‚
â”‚                                 â”‚
â”‚ æˆ–è¾“å…¥: [____]                  â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ [ç«‹å³å……å€¼ - MyApp]     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¶ˆè´¹æ—¥å¿—é¡µé¢ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        æ¶ˆè´¹æ—¥å¿—æŸ¥è¯¢                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å½“å‰ Key: [MyApp      â–¼]             â”‚
â”‚ æ—¶é—´èŒƒå›´: [æœ€è¿‘30å¤©  â–¼]              â”‚
â”‚                                       â”‚
â”‚ [æœç´¢] [åˆ·æ–°]                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ—¥æœŸ       â”‚ æ¨¡å‹        â”‚ æ¶ˆè´¹â”‚æˆæœ¬  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚ 11-05 08:30â”‚ claude-3-op â”‚12.5Kâ”‚3.12â”‚
â”‚ 11-04 15:22â”‚ gpt-4       â”‚ 5.2Kâ”‚1.87â”‚
â”‚ ...        â”‚ ...         â”‚ ... â”‚... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’¡ åˆ‡æ¢Keyåï¼Œæ—¥å¿—è‡ªåŠ¨åˆ·æ–°ä¸ºæ–°Keyçš„æ•°æ®
```

#### D. çŠ¶æ€ç®¡ç†ï¼ˆPiniaï¼‰

```javascript
// stores/key.js
export const useKeyStore = defineStore('key', {
  state: () => ({
    keys: [],           // æ‰€æœ‰ Keys
    currentKeyId: null, // å½“å‰é€‰ä¸­ Key ID
    keyInfo: null       // å½“å‰ Key çš„è¯¦ç»†ä¿¡æ¯
  }),

  getters: {
    currentKey: (state) => {
      return state.keys.find(k => k.keyId === state.currentKeyId)
    },

    currentKeyApiKey: (state) => {
      return state.currentKey?.apiKey
    }
  },

  actions: {
    // åˆ‡æ¢ Key
    async switchKey(keyId) {
      this.currentKeyId = keyId

      // è§¦å‘æ‰€æœ‰é¡µé¢çš„æ•°æ®åˆ·æ–°
      this.$patch({keyInfo: null})

      // è·å–æ–° Key çš„ä¿¡æ¯
      await this.fetchKeyInfo()

      // é€šçŸ¥å„é¡µé¢æ›´æ–°æ•°æ®
      this.$subscribe((mutation, state) => {
        uni.$emit('key-changed', state.currentKey)
      })
    },

    // è·å– Key è¯¦ç»†ä¿¡æ¯
    async fetchKeyInfo() {
      const response = await apiService.get('/wechat/key/info', {
        headers: {
          'X-API-Key': this.currentKeyApiKey
        }
      })
      this.keyInfo = response
    },

    // æ·»åŠ æ–° Key
    async addKey(keyData) {
      this.keys.push(keyData)
      await storageService.setKeys(this.keys)

      // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ª Keyï¼Œè‡ªåŠ¨é€‰ä¸­
      if (this.keys.length === 1) {
        this.currentKeyId = keyData.keyId
      }
    }
  }
})
```

#### E. é¡µé¢é—´çš„æ•°æ®åŒæ­¥

```javascript
// ä»»ä½•é¡µé¢åœ¨åˆ‡æ¢Keyæ—¶
export default {
  setup() {
    const keyStore = useKeyStore()

    // ç›‘å¬ Key å˜åŒ–
    watch(
      () => keyStore.currentKey,
      async (newKey) => {
        if (newKey) {
          // é‡æ–°åŠ è½½è¯¥é¡µé¢çš„æ•°æ®
          await this.loadData()
        }
      }
    )

    const loadData = async () => {
      // æ ¹æ®å½“å‰KeyåŠ è½½æ•°æ®
      this.data = await apiService.getBalance()
    }

    return { loadData }
  }
}
```

#### F. ç­¾åˆ°åœºæ™¯ç‰¹æ®Šå¤„ç†

```javascript
// æ”¯æŒå¤šKeyç­¾åˆ°
async checkinAllKeys() {
  const results = []

  for (const key of this.keys) {
    // é€ä¸ªä¸ºä¸åŒKeyç­¾åˆ°
    const result = await apiService.post('/wechat/checkin', {
      // é€šè¿‡X-API-Keyå¤´æŒ‡å®šä¸åŒçš„Key
    }, {
      headers: {
        'X-API-Key': key.apiKey
      }
    })
    results.push(result)
  }

  // æ˜¾ç¤ºæ‰€æœ‰Keyçš„ç­¾åˆ°ç»“æœ
  this.showCheckinResults(results)
}
```

**ç­¾åˆ°ç»“æœå±•ç¤ºï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ç­¾åˆ°ç»“æœ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… MyApp          ç­¾åˆ°æˆåŠŸ        â”‚
â”‚    è·å¾—: Â¥100  |  è¿ç»­: 5 å¤©      â”‚
â”‚                                   â”‚
â”‚ âœ… TestKey        ç­¾åˆ°æˆåŠŸ        â”‚
â”‚    è·å¾—: Â¥100  |  è¿ç»­: 3 å¤©      â”‚
â”‚                                   â”‚
â”‚ âœ… BackupKey      ç­¾åˆ°æˆåŠŸ        â”‚
â”‚    è·å¾—: Â¥100  |  è¿ç»­: 1 å¤©      â”‚
â”‚                                   â”‚
â”‚ æ€»è·å¾—: Â¥300                      â”‚
â”‚                                   â”‚
â”‚        [å…³é—­]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç»¼åˆæ–¹æ¡ˆæ€»ç»“

### âœ… å››ä¸ªç–‘é—®çš„æœ€ç»ˆæ–¹æ¡ˆ

| # | ç–‘é—® | æ–¹æ¡ˆ | åç«¯å½±å“ | å‰ç«¯å½±å“ |
|---|------|------|---------|---------|
| 1 | ä¸éœ€å¯¼å‡º | âœ… ç§»é™¤å¯¼å‡ºåŠŸèƒ½ | æ—  | ç§»é™¤æŒ‰é’® |
| 2 | Keyåç§°+å¯†é’¥ | âœ… åŒé‡æŸ¥è¯¢æ”¯æŒ | éªŒè¯æ¥å£æ— å˜åŒ– | æ–°å¢æœç´¢é€»è¾‘ |
| 3 | æ¸…ç©ºç¼“å­˜é‡æ–°æ·»åŠ  | âœ… å®Œå…¨æœ¬åœ°ç®¡ç† | **é›¶æ”¹åŠ¨**ï¼Œæ— éœ€ç”¨æˆ·ç³»ç»Ÿ | æœ¬åœ°ç¼“å­˜ç®¡ç† |
| 4 | å¤šKeyåˆ‡æ¢ | âœ… å…¨é¡µé¢æ”¯æŒåˆ‡æ¢ | åŸºäºKeyéªŒè¯ï¼ˆå·²æœ‰ï¼‰ | Keyé€‰æ‹©å™¨+çŠ¶æ€ç®¡ç† |

### åç«¯æ”¹åŠ¨æœ€å°åŒ–

```
âœ… æ— éœ€ä¿®æ”¹ï¼š
- ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- ç”¨æˆ·-Keyç»‘å®šè¡¨
- ç”¨æˆ·çŠ¶æ€ç®¡ç†

âœ… ä»…éœ€ç¡®ä¿ç°æœ‰åŠŸèƒ½ï¼š
- POST /wechat/key/validate    (éªŒè¯Key)
- POST /wechat/checkin          (æ¯ä¸ªKeyç‹¬ç«‹ç­¾åˆ°)
- GET  /wechat/balance          (åŸºäºX-API-Key)
- GET  /wechat/logs             (åŸºäºX-API-Key)
- POST /wechat/recharge/init    (åŸºäºX-API-Key)

ç»“æœï¼šåç«¯é›¶æ–°å¢ï¼Œå‰ç«¯å…¨æå®š
```

### å‰ç«¯æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å°ç¨‹åºæœ¬åœ° Storage                     â”‚
â”‚  â”œâ”€ keys: [{Key1}, {Key2}, {Key3}]    â”‚
â”‚  â”œâ”€ currentKeyId: "xxx"               â”‚
â”‚  â””â”€ lastSync: "2024-11-12"            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pinia Store (useKeyStore)              â”‚
â”‚  â”œâ”€ ç®¡ç†å½“å‰é€‰ä¸­Key                     â”‚
â”‚  â”œâ”€ ç›‘å¬Keyå˜åŒ–                        â”‚
â”‚  â””â”€ è§¦å‘é¡µé¢æ•°æ®åˆ·æ–°                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å„åŠŸèƒ½é¡µé¢                              â”‚
â”‚  â”œâ”€ é¦–é¡µ (ä¹å®«æ ¼)    [Keyé€‰æ‹©å™¨]       â”‚
â”‚  â”œâ”€ ä½™é¢æŸ¥è¯¢é¡µé¢     [Keyé€‰æ‹©å™¨]       â”‚
â”‚  â”œâ”€ æ¶ˆè´¹æ—¥å¿—é¡µé¢     [Keyé€‰æ‹©å™¨]       â”‚
â”‚  â”œâ”€ å……å€¼é¡µé¢         [Keyé€‰æ‹©å™¨]       â”‚
â”‚  â””â”€ ç­¾åˆ°é¡µé¢         [å¤šKeyç­¾åˆ°]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API è°ƒç”¨                                â”‚
â”‚  X-API-Key: {å½“å‰Key}                  â”‚
â”‚  è¯·æ±‚ CRS åç«¯æ¥å£                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµç¤ºä¾‹

```
åœºæ™¯ï¼šç”¨æˆ·ä»MyAppåˆ‡æ¢åˆ°TestKeyæŸ¥è¯¢ä½™é¢

1. ç”¨æˆ·åœ¨é¦–é¡µç‚¹å‡» [TestKey]
   â†“
2. Keyé€‰æ‹©å™¨è§¦å‘ keyStore.switchKey('testkey-id')
   â†“
3. Pinia store æ›´æ–° currentKeyId = 'testkey-id'
   â†“
4. é¡µé¢ç›‘å¬åˆ°Keyå˜åŒ–
   â†“
5. ä½™é¢é¡µé¢æ¥æ”¶åˆ° 'key-changed' äº‹ä»¶
   â†“
6. è°ƒç”¨ loadBalance() é‡æ–°è·å–æ•°æ®
   â†“
7. è¯·æ±‚å¤´è‡ªåŠ¨å˜ä¸º: X-API-Key: cr_testkey...
   â†“
8. åç«¯éªŒè¯Keyæœ‰æ•ˆæ€§åè¿”å›æ–°Keyçš„ä½™é¢ä¿¡æ¯
   â†“
9. é¡µé¢åˆ·æ–°æ˜¾ç¤º TestKey çš„ä½™é¢
```

---

## æœ€ç»ˆæ–‡æ¡£æ›´æ–°æ¸…å•

åŸºäºä»¥ä¸Šåˆ†æï¼Œéœ€è¦åœ¨åŸæ–‡æ¡£ä¸­ä¿®æ”¹ï¼š

- [ ] 1. ç§»é™¤"ğŸ“¤ å¯¼å‡º"åŠŸèƒ½ï¼Œæ”¹ä¸º"ğŸ“‹ æ›´å¤š"
- [ ] 2. åœ¨ 3.1 Keyç®¡ç†ç« èŠ‚æ–°å¢"æ”¯æŒåç§°å’Œå¯†é’¥åŒé‡æŸ¥è¯¢"è¯´æ˜
- [ ] 3. åœ¨ 1.1 æ¶æ„æ–¹æ¡ˆç« èŠ‚æ˜ç¡®è¯´æ˜"æœ¬åœ°ç¼“å­˜ç®¡ç†ï¼Œæ— éœ€åç«¯ç”¨æˆ·ç³»ç»Ÿ"
- [ ] 4. åœ¨ 6.3 Pinia Store è®¾è®¡ç« èŠ‚æ–°å¢"Keyåˆ‡æ¢é€»è¾‘"
- [ ] 5. åœ¨é¡µé¢å±•ç¤ºä¸­åŠ ä¸ŠKeyé€‰æ‹©å™¨ï¼ˆåœ¨æ‰€æœ‰åŠŸèƒ½é¡µé¢ï¼‰
- [ ] 6. æ–°å¢ä¸€ä¸ª "Key ç®¡ç†æ¶æ„" ç« èŠ‚è¯¦ç»†è¯´æ˜æ•´ä¸ªæµç¨‹

**è¿™æ˜¯æœ€ç®€æ´ã€æœ€é«˜æ•ˆã€æœ€ç¬¦åˆå°ç¨‹åºç‰¹æ€§çš„æ–¹æ¡ˆï¼** âœ¨
